---
import { ClientRouter } from 'astro:transitions';
import Head from '../components/Head.astro'
import TopNavbar from '../components/ui/TopNavbar.astro'
import Footer from '../components/ui/Footer.astro'
import FloatingWidget from '../components/ui/FloatingWidget.astro'
import { seo } from '../settings'
import { getLangFromUrl } from '../i18n/utils';

type Props = {
	title?: string
	description?: string
	image?: string
}

const {
	title = seo.default_title,
	description = seo.default_description,
	image = seo.default_image,
} = Astro.props

const currentLang = getLangFromUrl(Astro.url);
---

<!doctype html>
<html lang={currentLang}>
	<head>
		{import.meta.env.PROD && <ClientRouter />}
		<Head title={title} description={description} image={image} />
	</head>
	<body class="min-h-screen flex flex-col relative">
		<!-- 背景装饰 -->
		<div class="fixed inset-0 -z-10 overflow-hidden">
			<!-- 渐变背景 -->
			<div class="absolute inset-0 bg-gradient-to-br from-blue-50 via-white to-purple-50 dark:hidden"></div>
		</div>

		<header class="sticky top-0 z-50">
			<TopNavbar />
		</header>
		
		<main class="flex-grow p-4 md:p-8 w-full relative z-10">
			<div class="max-w-6xl mx-auto w-full">
				<slot />
			</div>
		</main>
		
		<Footer />
		<FloatingWidget />
	</body>
</html>

<style>
	html, body {
		margin: 0;
		padding: 0;
	}

	/* 网格背景图案 */
	.bg-grid-pattern {
		background-image: 
			linear-gradient(rgba(0, 0, 0, 0.1) 1px, transparent 1px),
			linear-gradient(90deg, rgba(0, 0, 0, 0.1) 1px, transparent 1px);
		background-size: 20px 20px;
	}

	/* 深色模式适配 */
	@media (prefers-color-scheme: dark) {
		.bg-grid-pattern {
			background-image: 
				linear-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px),
				linear-gradient(90deg, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
		}
	}

	/* 动画优化 */
	@keyframes float {
		0%, 100% { transform: translateY(0px); }
		50% { transform: translateY(-10px); }
	}

	.animate-float {
		animation: float 6s ease-in-out infinite;
	}
</style>
